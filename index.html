<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>스캔 서비스 가격 계산기</title>

  <!-- 캐시 방지 메타 태그 -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="cache-control" content="max-age=0">
  <meta name="cache-control" content="no-cache">
  <meta name="expires" content="0">
  <meta name="expires" content="Tue, 01 Jan 1980 1:00:00 GMT">
  <meta name="pragma" content="no-cache">

  <!-- 강력한 캐시 무효화 스크립트 -->
  <script>
    // 페이지 버전 체크 및 업데이트 알림
    (function () {
      const CURRENT_VERSION = '20250825_v5_JSON'; // JSON 설정 적용 버전

      // 파일명 기반 고유 키 생성
      const fileName = window.location.pathname.split('/').pop().split('.')[0] || 'index';
      const STORAGE_KEY = `page_version_${fileName}`;

      function createUpdateNotification() {
        // 기존 알림이 있으면 제거
        const existing = document.getElementById('update-notification');
        if (existing) existing.remove();

        // 업데이트 알림 생성
        const notification = document.createElement('div');
        notification.id = 'update-notification';
        notification.innerHTML = `
                  <div style="
                      position: fixed;
                      top: 20px;
                      left: 50%;
                      transform: translateX(-50%);
                      background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
                      color: white;
                      padding: 15px 25px;
                      border-radius: 25px;
                      box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
                      z-index: 10000;
                      font-family: 'Inter', 'Noto Sans KR', sans-serif;
                      font-weight: 700;
                      font-size: 16px;
                      text-align: center;
                      animation: slideDown 0.5s ease-out;
                      border: 2px solid rgba(255, 255, 255, 0.3);
                  ">
                      <div style="margin-bottom: 10px;">
                          🚀 새로운 버전이 있습니다!
                      </div>
                      <button onclick="updateToLatest()" style="
                          background: rgba(255, 255, 255, 0.2);
                          color: white;
                          border: 2px solid rgba(255, 255, 255, 0.5);
                          padding: 8px 20px;
                          border-radius: 20px;
                          font-weight: 700;
                          cursor: pointer;
                          font-size: 14px;
                          margin-right: 10px;
                          transition: all 0.3s ease;
                      " onmouseover="this.style.background='rgba(255,255,255,0.3)'" 
                         onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                          ✨ 최신 버전으로 업데이트
                      </button>
                      <button onclick="dismissUpdate()" style="
                          background: transparent;
                          color: rgba(255, 255, 255, 0.8);
                          border: 1px solid rgba(255, 255, 255, 0.3);
                          padding: 8px 15px;
                          border-radius: 20px;
                          font-weight: 600;
                          cursor: pointer;
                          font-size: 12px;
                      ">
                          나중에
                      </button>
                  </div>
                  <style>
                      @keyframes slideDown {
                          from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
                          to { transform: translateX(-50%) translateY(0); opacity: 1; }
                      }
                  </style>
              `;
        document.body.appendChild(notification);
      }

      window.updateToLatest = function () {
        // 로딩 표시
        const notification = document.getElementById('update-notification');
        if (notification) {
          notification.innerHTML = `
                      <div style="
                          position: fixed;
                          top: 20px;
                          left: 50%;
                          transform: translateX(-50%);
                          background: linear-gradient(45deg, #7c3aed, #a855f7);
                          color: white;
                          padding: 15px 25px;
                          border-radius: 25px;
                          box-shadow: 0 10px 30px rgba(124, 58, 237, 0.4);
                          z-index: 10000;
                          font-family: 'Inter', 'Noto Sans KR', sans-serif;
                          font-weight: 700;
                          font-size: 16px;
                          text-align: center;
                      ">
                          🔄 업데이트 중...
                      </div>
                  `;
        }

        // 캐시 클리어 후 새로고침
        if ('caches' in window) {
          caches.keys().then(names => {
            names.forEach(name => caches.delete(name));
          });
        }
        localStorage.setItem(STORAGE_KEY, CURRENT_VERSION);

        setTimeout(() => {
          window.location.reload(true);
        }, 1000);
      };

      window.dismissUpdate = function () {
        const notification = document.getElementById('update-notification');
        if (notification) {
          notification.style.animation = 'slideUp 0.5s ease-out forwards';
          setTimeout(() => notification.remove(), 500);
        }
        // 이번 세션에서는 다시 묻지 않음
        sessionStorage.setItem('update_dismissed', 'true');
      };

      try {
        const storedVersion = localStorage.getItem(STORAGE_KEY);
        const updateDismissed = sessionStorage.getItem('update_dismissed');

        if (storedVersion !== CURRENT_VERSION && !updateDismissed) {
          // 페이지 로드 후 알림 표시
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', createUpdateNotification);
          } else {
            setTimeout(createUpdateNotification, 1000);
          }
        }

        // URL에 타임스탬프 추가 (캐시 버스팅)
        if (!window.location.search.includes('v=')) {
          const separator = window.location.search ? '&' : '?';
          const newUrl = window.location.href + separator + 'v=' + Date.now();
          window.history.replaceState({}, '', newUrl);
        }
      } catch (e) {
        console.log('Cache busting script error:', e);
      }

      // slideUp 애니메이션 추가
      const style = document.createElement('style');
      style.textContent = `
              @keyframes slideUp {
                  from { transform: translateX(-50%) translateY(0); opacity: 1; }
                  to { transform: translateX(-50%) translateY(-100%); opacity: 0; }
              }
          `;
      document.head.appendChild(style);
    })();
  </script>

  <!-- 환경 분기: 모바일 vs 데스크탑 클래스 추가 -->
  <script>
    (function () {
      const isMobile = /Mobi|Android/i.test(navigator.userAgent);
      document.documentElement.classList.add(isMobile ? 'mobile-env' : 'desktop-env');
    })();
  </script>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap"
    rel="stylesheet">

  <style>
    /* 기본 테마 변수 */
    :root {
      --primary: #0d6efd;
      --secondary: #6c757d;
      --success: #198754;
      --info: #0dcaf0;
      --warning: #ffc107;
      --danger: #dc3545;
      --kakao-yellow: #FFEB00;
      --bg: #f8f9fa;
      --text: #343a40;
      --card-bg: #ffffff;
      --card-hover: rgba(0, 0, 0, 0.1);
    }

    /* 수동 토글용 다크모드 공통 변수 */
    .dark-mode {
      --primary: #339af0;
      --secondary: #adb5bd;
      --success: #20c997;
      --info: #64d9ff;
      --warning: #e09f3e;
      --danger: #ff6b6b;
      --kakao-yellow: #FFEB00;
      --bg: #121212;
      --text: #e0e0e0;
      --card-bg: #1e1e1e;
      --card-hover: rgba(255, 255, 255, 0.1);
    }

    /* 기본 스타일 */
    body {
      font-family: 'Inter', 'Noto Sans KR', sans-serif;
      background-color: var(--bg);
      color: var(--text);
    }

    h1 {
      font-weight: 700;
      letter-spacing: -0.5px;
      color: var(--primary);
    }

    .card {
      background-color: var(--card-bg);
      border-top: 4px solid var(--info);
      transition: transform .2s, box-shadow .2s;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 20px var(--card-hover);
    }

    .card-title i {
      color: var(--primary);
    }

    .badge-warning {
      background-color: var(--warning);
      color: #212529;
    }

    .btn-success {
      background-color: var(--success);
      border-color: var(--success);
    }

    .btn-success:hover {
      background-color: #157347;
    }

    .btn-secondary {
      background-color: var(--secondary);
      border-color: var(--secondary);
    }

    .result-text {
      color: var(--success);
    }

    .chat-btn {
      background-color: var(--kakao-yellow);
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transition: transform .2s;
      z-index: 10000;
    }

    .chat-btn i {
      color: #000;
      font-size: 1.8rem;
    }

    .chat-btn:hover {
      transform: scale(1.1);
    }

    /* 고정 견적 버튼 (모든 환경에서 표시) */
    .estimate-btn {
      position: fixed;
      bottom: 1.5rem;
      left: 1.5rem;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: var(--primary);
      color: white;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transition: transform .2s;
      z-index: 1000;
    }

    .estimate-btn i {
      font-size: 1.5rem;
    }

    .estimate-btn:hover {
      transform: scale(1.1);
      background-color: var(--primary);
    }

    /* 모바일에서만 견적 버튼 표시 (기존 코드 제거) */
    .modal-body pre {
      white-space: pre-wrap;
      background-color: var(--card-bg);
      padding: 1rem;
      border-radius: .5rem;
    }

    /* 토글 버튼 대비 강화 */
    html.dark-mode .btn-outline-secondary {
      color: #f5f5f5 !important;
      border-color: #6c757d !important;
    }

    html.dark-mode .btn-outline-secondary:hover {
      background-color: rgba(255, 255, 255, 0.1) !important;
    }

    /* 카드·모달 텍스트 밝게 */
    html.dark-mode .card-body,
    html.dark-mode .modal-body {
      color: var(--text) !important;
    }

    /* 다크모드용 테이블 기본 덮어쓰기 */
    html.dark-mode .table.table-bordered {
      background-color: var(--card-bg) !important;
      color: var(--text) !important;
    }

    /* 다크모드 테이블 헤더 색상 개선 */
    html.dark-mode .table.table-bordered thead {
      background-color: #2a2a2a !important;
    }

    html.dark-mode .table.table-bordered thead th {
      color: #ffffff !important;
      border-color: #404040 !important;
      font-weight: 600;
      background-color: #2a2a2a !important;
    }

    /* 라이트모드에서 테이블 헤더 */
    .table.table-bordered thead {
      background-color: #f8f9fa;
    }

    .table.table-bordered thead th {
      color: #343a40 !important;
      border-color: #dee2e6;
      font-weight: 600;
      background-color: #f8f9fa !important;
    }

    /* 다크모드 테이블 바디 색상 개선 */
    html.dark-mode .table.table-bordered tbody tr {
      background-color: #1e1e1e !important;
    }

    html.dark-mode .table.table-bordered tbody td {
      color: #ffffff !important;
      border-color: #404040 !important;
      background-color: #1e1e1e !important;
    }

    /* 다크모드 입력 필드 개선 */
    html.dark-mode .table input.form-control {
      background-color: #2d2d2d !important;
      border-color: #555 !important;
      color: #ffffff !important;
    }

    html.dark-mode .table input.form-control:focus {
      background-color: #3d3d3d !important;
      border-color: var(--primary) !important;
      box-shadow: 0 0 0 0.2rem rgba(51, 154, 240, 0.25) !important;
      color: #ffffff !important;
    }

    /* 다크모드 체크박스 개선 */
    html.dark-mode .table input[type="checkbox"] {
      background-color: #2d2d2d !important;
      border-color: #666 !important;
      filter: brightness(1.2) contrast(1.1);
    }

    html.dark-mode .table input[type="checkbox"]:checked {
      background-color: var(--primary) !important;
      border-color: var(--primary) !important;
    }

    /* 다크모드 개별 가격 텍스트 강화 */
    html.dark-mode .table .individualPrice {
      color: #ffffff !important;
      font-weight: 600;
    }

    /* 다크모드 버튼 개선 */
    html.dark-mode .table .btn-danger {
      background-color: #dc3545 !important;
      border-color: #dc3545 !important;
      color: #ffffff !important;
    }

    html.dark-mode .table .btn-danger:hover {
      background-color: #c82333 !important;
      border-color: #bd2130 !important;
    }

    /* 다크모드 테이블 푸터 버튼 */
    html.dark-mode .table tfoot .btn-success {
      background-color: var(--success) !important;
      border-color: var(--success) !important;
      color: #ffffff !important;
    }

    /* 다크모드 테이블 푸터 셀 */
    html.dark-mode .table tfoot td {
      background-color: #1e1e1e !important;
      border-color: #404040 !important;
    }

    /* 다크모드 할인율 카드 */
    html.dark-mode .card.border-success .card-body.bg-light {
      background-color: #2a2a2a !important;
      color: var(--text) !important;
    }

    html.dark-mode .card.border-success .bg-white {
      background-color: #3a3a3a !important;
      color: var(--text) !important;
    }

    /* 다크모드 새로운 할인 카드 */
    html.dark-mode .discount-card .discount-highlight {
      background: linear-gradient(135deg, #1e5631 0%, #155e63 100%) !important;
    }

    html.dark-mode .discount-item .bg-white {
      background-color: #2d2d2d !important;
      color: var(--text) !important;
    }

    /* 할인율 카드 애니메이션 */
    .discount-card {
      animation: fadeInUp 0.6s ease-out;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .discount-item {
      animation: scaleIn 0.8s ease-out;
      transition: transform 0.2s ease;
    }

    .discount-item:hover {
      transform: translateY(-5px) scale(1.05);
    }

    .discount-percentage {
      animation: bounce 2s infinite;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.8);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes bounce {

      0%,
      20%,
      50%,
      80%,
      100% {
        transform: translateY(0);
      }

      40% {
        transform: translateY(-3px);
      }

      60% {
        transform: translateY(-2px);
      }
    }

    /* 그라데이션 배경 효과 */
    .discount-highlight {
      background: linear-gradient(45deg, #f8f9fa, #e9ecef);
      position: relative;
      overflow: hidden;
    }

    .discount-highlight::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      animation: shine 3s infinite;
    }

    @keyframes shine {
      0% {
        transform: translateX(-100%) translateY(-100%) rotate(45deg);
      }

      100% {
        transform: translateX(100%) translateY(100%) rotate(45deg);
      }
    }

    /* 구매 욕구 자극 UI */
    .recommendation-box {
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      border-left: 4px solid var(--info);
      padding: 12px 16px;
      margin: 10px 0;
      border-radius: 8px;
      animation: slideInLeft 0.5s ease-out;
    }

    .bundle-offer {
      background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
      border: 2px solid #ff9800;
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      position: relative;
      animation: pulse 2s infinite;
    }

    .urgency-banner {
      background: linear-gradient(45deg, #ff5722, #ff7043);
      color: white;
      padding: 10px 15px;
      margin: 10px 0;
      border-radius: 8px;
      text-align: center;
      animation: urgent-blink 1.5s infinite;
      box-shadow: 0 4px 15px rgba(255, 87, 34, 0.3);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .progress-bar-custom {
      background-color: #e0e0e0;
      border-radius: 10px;
      height: 8px;
      overflow: hidden;
      margin: 8px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4caf50, #8bc34a);
      border-radius: 10px;
      transition: width 0.8s ease-out;
      animation: shimmer 1.5s infinite;
    }

    @keyframes slideInLeft {
      from {
        transform: translateX(-20px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes pulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.02);
      }
    }

    @keyframes urgent-blink {

      0%,
      50% {
        opacity: 1;
      }

      25%,
      75% {
        opacity: 0.8;
      }
    }

    @keyframes shimmer {
      0% {
        background-position: -200px 0;
      }

      100% {
        background-position: 200px 0;
      }
    }

    /* 다크모드 지원 */
    html.dark-mode .recommendation-box {
      background: linear-gradient(135deg, #1a237e 0%, #303f9f 100%);
      color: #ffffff;
    }

    html.dark-mode .bundle-offer {
      background: linear-gradient(135deg, #3e2723 0%, #5d4037 100%);
      border-color: #ff9800;
      color: #ffffff;
    }

    /* 툴팁 스타일 */
    .tooltip-container {
      position: relative;
      display: inline-block;
    }

    .help-icon {
      color: #6c757d;
      cursor: help;
      font-size: 0.8rem;
      margin-left: 4px;
      transition: color 0.2s ease;
    }

    .help-icon:hover {
      color: var(--primary);
    }

    .custom-tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #333;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 0.85rem;
      white-space: normal;
      min-width: 200px;
      max-width: 300px;
      z-index: 99999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      pointer-events: none;
      text-align: center;
    }

    .custom-tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 5px solid transparent;
      border-top-color: #333;
    }

    .tooltip-container:hover .custom-tooltip {
      opacity: 1;
      visibility: visible;
    }

    /* 테이블 반응형 오버플로우 오버라이드 */
    .table-responsive {
      overflow: visible !important;
    }

    @media (max-width: 768px) {
      .table-responsive {
        overflow-x: auto !important;
        overflow-y: visible !important;
      }
    }

    html.dark-mode .custom-tooltip {
      background-color: #555;
      color: #fff;
    }

    html.dark-mode .custom-tooltip::after {
      border-top-color: #555;
    }

    /* 모바일에서 긴급성 메시지 개선 */
    @media (max-width: 768px) {
      .urgency-banner {
        font-size: 0.9rem;
        padding: 8px 12px;
        white-space: normal;
        line-height: 1.3;
      }

      .custom-tooltip {
        font-size: 0.8rem;
        padding: 6px 10px;
        white-space: normal;
        width: 200px;
        text-align: center;
      }

      .tooltip-container {
        position: static;
      }

      .custom-tooltip {
        position: fixed;
        bottom: auto;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        min-width: 250px;
        max-width: 90vw;
        font-size: 0.9rem;
        padding: 12px 16px;
      }
    }
  </style>
</head>

<body>
  <!-- 다크모드 토글 버튼 -->
  <div class="d-flex justify-content-end p-3">
    <button id="theme-toggle" class="btn btn-outline-secondary">
      <i class="bi bi-moon-fill" id="theme-icon"></i>
    </button>
  </div>

  <div class="container py-5">
    <div class="row g-4">
      <!-- 헤더 -->
      <div class="col-12 text-center">
        <h1 class="mb-3">스캔 서비스 가격 계산기</h1>
      </div>

      <!-- 할인율 안내 -->
      <div class="col-12">
        <div class="card shadow-lg border-success discount-card">
          <div class="card-body text-center discount-highlight"
            style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
            <h3 class="card-title text-white mb-4">
              <i class="bi bi-star-fill me-2" style="color: #ffd700;"></i>💰 대량 스캔 특별 할인 💰
            </h3>
            <div class="row g-4">
              <div class="col-md-4">
                <div class="discount-item p-4 bg-white rounded-3 border shadow-sm">
                  <h1 class="discount-percentage text-success mb-2" style="font-size: 3rem; font-weight: bold;">5%</h1>
                  <p class="mb-1 fw-bold fs-5">5권 이상</p>
                  <small class="text-muted">첫 할인 혜택!</small>
                </div>
              </div>
              <div class="col-md-4">
                <div class="discount-item p-4 bg-white rounded-3 border shadow-sm">
                  <h1 class="discount-percentage text-warning mb-2" style="font-size: 3rem; font-weight: bold;">10%</h1>
                  <p class="mb-1 fw-bold fs-5">10권 이상</p>
                  <small class="text-muted">인기 할인!</small>
                </div>
              </div>
              <div class="col-md-4">
                <div class="discount-item p-4 bg-white rounded-3 border shadow-sm">
                  <h1 class="discount-percentage text-danger mb-2" style="font-size: 3rem; font-weight: bold;">15%</h1>
                  <p class="mb-1 fw-bold fs-5">20권 이상</p>
                  <small class="text-muted">최대 할인!</small>
                </div>
              </div>
            </div>
            <div class="mt-4">
              <p class="text-white mb-0 fs-5">
                <i class="bi bi-lightning-fill me-2" style="color: #ffd700;"></i>
                <strong>많이 스캔할수록 더 많이 절약하세요!</strong>
              </p>
              <p class="text-white mb-2 fs-6 mt-2">
                <i class="bi bi-bookmark-star-fill me-2" style="color: #ffd700;"></i>
                <strong>목차 작성: 책과 함께 주문시 30% 할인!</strong>
              </p>
              <p class="text-white mb-0 fs-6">
                <i class="bi bi-calendar-event me-2" style="color: #ffd700;"></i>
                <strong>특가 기간: 8월 21일까지!</strong>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- 서비스 안내 -->
      <div class="col-md-6">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <h5 class="card-title mb-3"><i class="bi bi-book-half me-2"></i>북스캔 서비스</h5>
            <p class="card-text mb-3">책을 PDF로 만들어 공간을 절약하고, 언제든 편하게 보관하세요!</p>
            <ul class="list-unstyled ps-3 mb-3">
              <li class="mb-2"><i class="bi bi-file-earmark-text me-2 text-info"></i>OCR (검색 가능한 PDF 제공)</li>
              <li class="mb-2"><i class="bi bi-aspect-ratio me-2 text-success"></i>고해상도(400dpi) 옵션</li>
              <li class="mb-2"><i class="bi bi-percent me-2 text-warning"></i>대량 스캔 할인</li>
              <li class="mb-2"><i class="bi bi-cloud-upload me-2 text-secondary"></i>이메일 · 클라우드 전달</li>
              <li class="mb-2"><i class="bi bi-clock-history me-2 text-primary"></i>영도 지역 저녁 수령 가능</li>
            </ul>
            <span class="badge badge-warning">주의: 가로폭 240mm 이상 스캔 불가</span>
          </div>
        </div>
      </div>

      <!-- 샘플 다운로드 -->
      <div class="col-md-6">
        <div class="card h-100 shadow-sm d-flex flex-column justify-content-between">
          <div class="card-body">
            <h5 class="card-title mb-3"><i class="bi bi-folder2-open me-2"></i>샘플 파일</h5>
            <p class="card-text mb-4">다양한 해상도와 OCR 샘플을 확인해보세요.</p>
          </div>
          <div class="card-footer bg-transparent border-0">
            <div class="d-grid gap-2">
              <a href="sample/300dpi_sample.pdf" target="_blank" class="btn btn-outline-info">300dpi 샘플</a>
              <a href="sample/400dpi_sample.pdf" target="_blank" class="btn btn-outline-success">400dpi 샘플</a>
              <a href="sample/ocr_sample.pdf" target="_blank" class="btn btn-outline-warning">OCR 샘플</a>
            </div>
          </div>
        </div>
      </div>

      <!-- 가격표 카드 -->
      <div class="col-12">
        <div class="card shadow-sm mb-4">
          <div class="card-body">
            <h5 class="card-title mb-3"><i class="bi bi-list-ol me-2"></i>기본 가격표</h5>
            <div class="table-responsive">
              <table class="table table-bordered align-middle text-center">
                <thead class="table-light">
                  <tr>
                    <th>페이지 범위</th>
                    <th>기본 가격</th>
                    <th>OCR 옵션</th>
                    <th>고해상도 옵션</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>1 ~ 300쪽</td>
                    <td>4,000원</td>
                    <td>+2,000원</td>
                    <td>+2,000원</td>
                  </tr>
                  <tr>
                    <td>301 ~ 400쪽</td>
                    <td>5,000원</td>
                    <td>+2,000원</td>
                    <td>+2,000원</td>
                  </tr>
                  <tr>
                    <td>401 ~ 500쪽</td>
                    <td>6,000원</td>
                    <td>+2,000원</td>
                    <td>+2,000원</td>
                  </tr>
                  <tr>
                    <td>501 ~ 600쪽</td>
                    <td>7,000원</td>
                    <td>+2,000원</td>
                    <td>+2,000원</td>
                  </tr>
                  <tr>
                    <td>601쪽 이상</td>
                    <td>기본 4,000원 + (페이지초과÷100)*1,000원</td>
                    <td>+2,000원</td>
                    <td>+2,000원</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="row mt-2">
              <div class="col-md-6">
                <p class="small text-info mb-1"><i class="bi bi-info-circle me-1"></i><strong>OCR 옵션:</strong> 텍스트 검색
                  가능한 PDF</p>
              </div>
              <div class="col-md-6">
                <p class="small text-success mb-1"><i class="bi bi-aspect-ratio me-1"></i><strong>고해상도 옵션:</strong>
                  400dpi 고화질 스캔</p>
              </div>
            </div>
            <div class="mt-3">
              <h6 class="text-info"><i class="bi bi-list-ul me-2"></i>목차 작성 옵션</h6>
              <div class="table-responsive">
                <table class="table table-sm table-bordered align-middle text-center">
                  <thead class="table-light">
                    <tr>
                      <th>목차 개수</th>
                      <th>정가</th>
                      <th>할인가 (30%↓)</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>1 ~ 10개</td>
                      <td>3,000원</td>
                      <td class="text-success fw-bold">2,100원</td>
                    </tr>
                    <tr>
                      <td>11 ~ 30개</td>
                      <td>3,250원 ~ 5,000원</td>
                      <td class="text-success fw-bold">2,275원 ~ 3,500원</td>
                    </tr>
                    <tr>
                      <td>31 ~ 60개</td>
                      <td>5,080원 ~ 8,000원</td>
                      <td class="text-success fw-bold">3,556원 ~ 5,600원</td>
                    </tr>
                    <tr>
                      <td>61 ~ 100개</td>
                      <td>8,060원 ~ 10,400원</td>
                      <td class="text-success fw-bold">5,642원 ~ 7,280원</td>
                    </tr>
                    <tr>
                      <td>101개 이상</td>
                      <td>10,450원~</td>
                      <td class="text-success fw-bold">7,315원~</td>
                    </tr>
                  </tbody>
                </table>
                <small class="text-success d-block mt-2">
                  <i class="bi bi-gift-fill me-1"></i>
                  <strong>책 스캔과 함께 주문시 30% 할인 자동 적용!</strong>
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 가격 계산 -->
      <div class="col-12" id="price-calculator">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="d-flex mb-3 justify-content-between align-items-center flex-wrap">
              <h5 class="card-title mb-2"><i class="bi bi-calculator me-2"></i>가격 계산</h5>
              <div class="btn-group mb-2">
                <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#estimateModal"
                  onclick="prepareEstimate()"><i class="bi bi-clipboard me-1"></i>견적서 보기/복사</button>
              </div>
              <div id="discountInfo" class="fs-6 text-danger mb-2" style="min-height: 1.5rem;">&nbsp;</div>
              <div id="result" class="fs-4 fw-semibold result-text mb-2" style="min-height: 2rem;">총 가격: 0원</div>

              <!-- 긴급성 메시지 -->
              <div id="urgencyMessage" class="urgency-banner" style="display: none;">
                ⏰ <strong>특가 종료까지 2시간 30분!</strong> 지금 주문하세요!
              </div>

              <!-- 번들 할인 제안 -->
              <div id="bundleOffer" class="bundle-offer" style="display: none;">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <strong>🎯 <span id="bundleText">2권 더 추가하면 10% 할인!</span></strong>
                    <div class="progress-bar-custom">
                      <div id="discountProgress" class="progress-fill" style="width: 60%"></div>
                    </div>
                    <small class="text-muted">할인까지 <span id="booksNeeded">2권</span> 더 필요해요!</small>
                  </div>
                  <div class="text-end">
                    <div class="fs-5 fw-bold text-success">💰 <span id="potentialSavings">0</span>원 절약!</div>
                  </div>
                </div>
              </div>

              <!-- 개인화된 추천 -->
              <div id="recommendation" class="recommendation-box" style="display: none;">
                <i class="bi bi-lightbulb text-warning me-2"></i>
                <span id="recommendationText">📖 이런 두께의 책이라면 OCR 옵션을 추천해요!</span>
              </div>
            </div>
            <div class="table-responsive mb-3" style="overflow: visible;">
              <table class="table table-bordered align-middle text-center" id="bookTable" style="overflow: visible;">
                <thead>
                  <tr>
                    <th>쪽 수</th>
                    <th>
                      <div class="tooltip-container">
                        OCR
                        <i class="bi bi-question-circle help-icon"></i>
                        <div class="custom-tooltip">
                          텍스트 검색이 가능한 PDF로 만들어드려요!<br>
                          <small>단어나 문장을 바로 찾을 수 있어요</small>
                        </div>
                      </div>
                    </th>
                    <th>
                      <div class="tooltip-container">
                        고해상도
                        <i class="bi bi-question-circle help-icon"></i>
                        <div class="custom-tooltip">
                          400dpi 고화질로 선명하게!<br>
                          <small>이미지와 도표가 더 깨끗해요</small>
                        </div>
                      </div>
                    </th>
                    <th>
                      <div class="tooltip-container">
                        목차
                        <i class="bi bi-question-circle help-icon"></i>
                        <div class="custom-tooltip">
                          클릭 한 번으로 원하는 페이지로!<br>
                          <small>✅ 굿노트, 플렉슬 완벽 호환</small><br>
                          <small>📊 목차 1~10개: 3,000원 / 목차 11~30개: 최대 5,000원</small><br>
                          <small>📊 목차 31~60개: 최대 8,000원 / 목차 61~100개: 최대 10,400원</small><br>
                          <small class="text-success">🎉 책과 함께 주문시 30% 할인!</small>
                        </div>
                      </div>
                    </th>
                    <th>가격</th>
                    <th>삭제</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><input type="number" class="form-control pageCount" min="1" value="100" placeholder="쪽수"></td>
                    <td><input type="checkbox" class="form-check-input ocr"></td>
                    <td><input type="checkbox" class="form-check-input highRes"></td>
                    <td><input type="number" class="form-control tocCount" min="0" value="0" placeholder="목차 개수"></td>
                    <td class="individualPrice">4000원</td>
                    <td><button class="btn btn-sm btn-danger" onclick="removeRow(this)">삭제</button></td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <td colspan="6" class="p-2">
                      <button class="btn btn-success w-100" onclick="addRow()">
                        <i class="bi bi-plus-lg me-2"></i>책 추가
                      </button>
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 견적서 모달 -->
  <div class="modal fade" id="estimateModal" tabindex="-1" aria-labelledby="estimateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header" style="background-color: var(--info); color: #fff;">
          <h5 class="modal-title" id="estimateModalLabel"><i class="bi bi-journal-text me-2"></i>견적서</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="닫기"></button>
        </div>
        <div class="modal-body">
          <pre id="estimateContent"></pre>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-info" onclick="copyEstimate()">클립보드에 복사</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 고정 견적 버튼 -->
  <button class="estimate-btn" onclick="scrollToCalculator()">
    <i class="bi bi-calculator"></i>
  </button>

  <!-- 카카오톡 채팅 버튼 -->
  <a href="http://pf.kakao.com/_KGxevn/chat" target="_blank" class="chat-btn"><i class="bi bi-chat-dots-fill"></i></a>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // 전역 변수로 가격 정책 저장
    let pricingConfig = null;

    // 1) 환경 분기: 모바일 vs 데스크탑 클래스 추가
    (function () {
      const isMobile = /Mobi|Android/i.test(navigator.userAgent);
      document.documentElement.classList.add(isMobile ? 'mobile-env' : 'desktop-env');
    })();

    // 2) 다크모드 토글 & 로컬 저장
    const rootEl = document.documentElement;
    const toggleBtn = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');

    if (localStorage.getItem('theme') === 'dark') {
      rootEl.classList.add('dark-mode');
      themeIcon.className = 'bi bi-sun-fill';
    }

    toggleBtn.addEventListener('click', () => {
      const isDark = rootEl.classList.toggle('dark-mode');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      themeIcon.className = isDark ? 'bi bi-sun-fill' : 'bi bi-moon-fill';
    });

    // 3) 가격 정책 로딩 함수
    async function loadPricingConfig() {
      try {
        // 프로토콜이 file:// 인 경우 직접 기본값 사용 (CORS 방지)
        if (window.location.protocol === 'file:') {
          console.log('로컬 파일 실행 감지, 기본 가격 정책 사용');
          pricingConfig = getDefaultPricingConfig();
          console.log('기본 가격 정책 로드 완료:', pricingConfig.version);
          console.log('OCR 가격:', pricingConfig.scan_pricing.options.ocr);
          console.log('고해상도 가격:', pricingConfig.scan_pricing.options.high_resolution);

          // UI 업데이트
          updatePricingTable();
          updateTooltips();
          calculatePrice();
          return;
        }

        // HTTP/HTTPS 프로토콜인 경우 JSON 파일 로드 시도
        const timestamp = new Date().getTime();
        const random = Math.floor(Math.random() * 10000);
        const response = await fetch(`pricing_config.json?v=${timestamp}&r=${random}`, {
          cache: 'no-cache',
          headers: {
            'Cache-Control': 'no-cache, no-store, must-revalidate',
            'Pragma': 'no-cache',
            'Expires': '0'
          }
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        pricingConfig = await response.json();
        console.log('가격 정책 로드 완료:', pricingConfig.version);
        console.log('OCR 가격:', pricingConfig.scan_pricing.options.ocr);
        console.log('고해상도 가격:', pricingConfig.scan_pricing.options.high_resolution);

        // 가격 정책 로드 후 UI 업데이트
        updatePricingTable();
        updateTooltips();
        calculatePrice();
      } catch (error) {
        console.warn('가격 정책 로딩 실패, 기본값 사용:', error.message);
        // 기본값으로 폴백
        pricingConfig = getDefaultPricingConfig();
        console.log('기본 가격 정책으로 폴백:', pricingConfig.version);
        updatePricingTable();
        updateTooltips();
        calculatePrice();
      }
    }

    // 기본 가격 정책 (폴백용) - JSON 파일과 완전히 동일하게 설정
    function getDefaultPricingConfig() {
      return {
        version: "2025.08.25",
        last_updated: "2025-08-25T00:00:00Z",
        scan_pricing: {
          base_prices: [
            { max_pages: 300, price: 4000 },
            { max_pages: 400, price: 5000 },
            { max_pages: 500, price: 6000 },
            { max_pages: 600, price: 7000 },
            { max_pages: null, base_price: 4000, extra_per_100: 1000 }
          ],
          options: {
            ocr: 1000,           // JSON 설정과 동일
            high_resolution: 1000 // JSON 설정과 동일
          }
        },
        toc_pricing: {
          tiers: [
            { max_count: 10, base_price: 3000, per_item: 0 },
            { max_count: 30, base_price: 3000, per_item: 250, threshold: 10 },
            { max_count: 60, base_price: 5000, per_item: 80, threshold: 30 },
            { max_count: 100, base_price: 8000, per_item: 60, threshold: 60 },
            { max_count: null, base_price: 10400, per_item: 50, threshold: 100 }
          ],
          bundle_discount: 0.3
        },
        bulk_discounts: [
          { min_books: 5, discount_rate: 0.05 },
          { min_books: 10, discount_rate: 0.10 },
          { min_books: 20, discount_rate: 0.15 }
        ],
        promotion: {
          active: true,
          end_date: "2025-08-21T23:59:59Z",
          description: "특가 기간: 8월 21일까지!"
        },
        service_info: {
          max_width_mm: 240,
          min_pages: 1,
          default_pages: 100,
          default_toc_count: 0
        },
        display_messages: {
          urgency_messages: [
            "⏰ 특가 종료까지 {time}! 지금 주문하세요!",
            "🔥 8월 21일까지 한정 특가! 남은 시간 {time}",
            "⚡ 마감 임박! {time} 후 정가로 복귀합니다!",
            "🎯 특별 할인 마감까지 {time} 남았어요!"
          ],
          recommendations: {
            ocr_threshold: 300,
            high_res_threshold: 200,
            toc_threshold: 400,
            bundle_threshold: 250
          },
          tooltips: {
            ocr: "텍스트 검색이 가능한 PDF로 만들어드려요!<br><small>단어나 문장을 바로 찾을 수 있어요</small>",
            high_resolution: "400dpi 고화질로 선명하게!<br><small>이미지와 도표가 더 깨끗해요</small>",
            toc: "클릭 한 번으로 원하는 페이지로!<br><small>✅ 굿노트, 플렉슬 완벽 호환</small><br><small>📊 목차 1~10개: 3,000원 / 목차 11~30개: 최대 5,000원</small><br><small>📊 목차 31~60개: 최대 8,000원 / 목차 61~100개: 최대 10,400원</small><br><small class=\"text-success\">🎉 책과 함께 주문시 30% 할인!</small>"
          }
        }
      };
    }

    // 4) 가격 계산 로직
    let lastEstimateText = '';
    document.addEventListener("DOMContentLoaded", function () {
      loadPricingConfig();
    });
    document.getElementById("bookTable").addEventListener("input", calculatePrice);
    document.getElementById("bookTable").addEventListener("change", calculatePrice);

    // 1분마다 긴급성 메시지 업데이트 (실시간 카운트다운)
    setInterval(() => {
      const bookSum = document.querySelectorAll("#bookTable tbody tr").length;
      updateUrgencyMessage(bookSum);
    }, 60000); // 1분마다 업데이트

    // 엔터키로 줄 추가 기능
    document.getElementById("bookTable").addEventListener("keydown", function (e) {
      if (e.key === "Enter" && e.target.classList.contains("pageCount")) {
        const allPageInputs = document.querySelectorAll(".pageCount");
        const lastPageInput = allPageInputs[allPageInputs.length - 1];

        // 마지막 쪽수 입력 필드에서 엔터를 눌렀을 때만 줄 추가
        if (e.target === lastPageInput) {
          e.preventDefault();
          addRow();
          // 새로 추가된 줄의 쪽수 입력에 포커스
          setTimeout(() => {
            const newPageInputs = document.querySelectorAll(".pageCount");
            const newLastInput = newPageInputs[newPageInputs.length - 1];
            newLastInput.focus();
            newLastInput.select();
          }, 100);
        }
      }
    });

    function addRow() {
      const tbody = document.querySelector("#bookTable tbody");
      const newRow = tbody.rows[0].cloneNode(true);
      const defaultPages = pricingConfig?.service_info?.default_pages || 100;
      const defaultTocCount = pricingConfig?.service_info?.default_toc_count || 0;

      newRow.querySelectorAll("input").forEach(input => {
        if (input.type === "number") {
          if (input.classList.contains("pageCount")) {
            input.value = defaultPages;
          } else if (input.classList.contains("tocCount")) {
            input.value = defaultTocCount;
          }
        }
        if (input.type === "checkbox")
          input.checked = false;
      });

      const basePrice = pricingConfig?.scan_pricing?.base_prices?.[0]?.price || 4000;
      newRow.querySelector(".individualPrice").innerText = `${basePrice}원`;
      tbody.appendChild(newRow);
      calculatePrice();
    } function removeRow(btn) {
      const tbody = document.querySelector("#bookTable tbody");
      if (tbody.rows.length > 1)
        btn.closest("tr").remove();
      calculatePrice();
    }

    function calculatePrice() {
      if (!pricingConfig) return; // 가격 정책이 로드되지 않았으면 중단

      // 디버깅: 현재 사용 중인 옵션 가격 확인
      console.log('현재 옵션 가격 - OCR:', pricingConfig.scan_pricing.options.ocr, '원, 고해상도:', pricingConfig.scan_pricing.options.high_resolution, '원');

      let totalBase = 0, bookSum = 0;
      document.querySelectorAll("#bookTable tbody tr").forEach((row, index) => {
        const c = 1; // 한 줄에 한 권으로 고정
        const p = +row.querySelector(".pageCount").value;
        const o = row.querySelector(".ocr").checked;
        const h = row.querySelector(".highRes").checked;
        const tocCount = parseInt(row.querySelector(".tocCount").value) || 0;

        // JSON 설정을 사용한 기본 가격 계산
        let perBookPrice = calculateBookPrice(p);
        let ocrCost = 0, highResCost = 0;

        // 옵션 가격
        if (o) {
          ocrCost = pricingConfig.scan_pricing.options.ocr;
          perBookPrice += ocrCost;
        }
        if (h) {
          highResCost = pricingConfig.scan_pricing.options.high_resolution;
          perBookPrice += highResCost;
        }

        // 디버깅: 개별 책의 가격 계산 과정
        console.log(`책 ${index + 1}: 기본가격 ${calculateBookPrice(p)}원 + OCR ${ocrCost}원 + 고해상도 ${highResCost}원`);

        // 목차 가격 계산
        if (tocCount > 0) {
          let tocPrice = calculateTocPrice(tocCount);

          // 책과 함께 주문 시 목차 할인 적용
          if (p > 0) {
            tocPrice = Math.round(tocPrice * (1 - pricingConfig.toc_pricing.bundle_discount));
          }

          perBookPrice += tocPrice;
          console.log(`책 ${index + 1}: 목차 가격 ${tocPrice}원 추가`);
        }

        // 권 수 반영
        const base = perBookPrice * c;
        row.querySelector(".individualPrice").innerText = `${base}원`;

        totalBase += base;
        bookSum += c;
      });

      // JSON 설정을 사용한 할인 계산
      const discountRate = calculateBulkDiscount(bookSum);
      const discountAmount = Math.round(totalBase * discountRate);
      const total = Math.round(totalBase * (1 - discountRate));

      console.log(`총 계산: 기본 총액 ${totalBase}원, 할인율 ${discountRate * 100}%, 최종 ${total}원`);

      document.getElementById("result").innerText = `총 가격: ${total}원`;
      document.getElementById("discountInfo").innerHTML =
        discountRate > 0
          ? `할인율: ${discountRate * 100}% 적용 (절약 ${discountAmount}원)`
          : '&nbsp;';

      // 마케팅 기능들 업데이트
      updateMarketingMessages(bookSum, totalBase, discountRate);
    }

    // 책 가격 계산 함수
    function calculateBookPrice(pages) {
      const basePrices = pricingConfig.scan_pricing.base_prices;

      for (let tier of basePrices) {
        if (tier.max_pages === null) {
          // 마지막 구간 (601쪽 이상)
          return tier.base_price + Math.ceil((pages - 600) / 100) * tier.extra_per_100;
        } else if (pages <= tier.max_pages) {
          return tier.price;
        }
      }

      // 폴백 (여기까지 올 일은 없어야 함)
      return 4000;
    }

    // 목차 가격 계산 함수
    function calculateTocPrice(tocCount) {
      const tiers = pricingConfig.toc_pricing.tiers;

      for (let tier of tiers) {
        if (tier.max_count === null) {
          // 마지막 구간 (101개 이상)
          return tier.base_price + (tocCount - tier.threshold) * tier.per_item;
        } else if (tocCount <= tier.max_count) {
          if (tier.threshold && tocCount > tier.threshold) {
            return tier.base_price + (tocCount - tier.threshold) * tier.per_item;
          } else {
            return tier.base_price;
          }
        }
      }

      // 폴백
      return 3000;
    }

    // 대량 할인율 계산 함수
    function calculateBulkDiscount(bookCount) {
      const discounts = pricingConfig.bulk_discounts;
      let applicableDiscount = 0;

      for (let discount of discounts) {
        if (bookCount >= discount.min_books) {
          applicableDiscount = discount.discount_rate;
        }
      }

      return applicableDiscount;
    }

    // 마케팅 메시지 업데이트 함수
    function updateMarketingMessages(bookSum, totalBase, currentDiscountRate) {
      updateBundleOffer(bookSum, totalBase);
      updateRecommendations();
      updateUrgencyMessage(bookSum);
    }

    // 번들 할인 제안
    function updateBundleOffer(bookSum, totalBase) {
      if (!pricingConfig) return;

      const bundleOffer = document.getElementById('bundleOffer');
      const bundleText = document.getElementById('bundleText');
      const booksNeeded = document.getElementById('booksNeeded');
      const potentialSavings = document.getElementById('potentialSavings');
      const discountProgress = document.getElementById('discountProgress');

      let nextThreshold = 0;
      let nextDiscount = 0;
      let progressPercent = 0;

      const discounts = pricingConfig.bulk_discounts;

      // 현재 단계와 다음 단계 찾기
      for (let i = 0; i < discounts.length; i++) {
        if (bookSum < discounts[i].min_books) {
          nextThreshold = discounts[i].min_books;
          nextDiscount = discounts[i].discount_rate;

          // 진행률 계산
          const prevThreshold = i > 0 ? discounts[i - 1].min_books : 0;
          progressPercent = ((bookSum - prevThreshold) / (nextThreshold - prevThreshold)) * 100;

          bundleText.textContent = `${nextThreshold - bookSum}권 더 추가하면 ${nextDiscount * 100}% 할인!`;
          booksNeeded.textContent = nextThreshold - bookSum;
          break;
        }
      }

      if (nextThreshold > 0 && bookSum < nextThreshold) {
        const potentialSavingAmount = Math.round(totalBase * nextDiscount);
        potentialSavings.textContent = potentialSavingAmount.toLocaleString();
        discountProgress.style.width = `${Math.max(10, progressPercent)}%`;
        bundleOffer.style.display = 'block';
      } else {
        bundleOffer.style.display = 'none';
      }
    }

    // 개인화된 추천
    function updateRecommendations() {
      if (!pricingConfig || !pricingConfig.display_messages || !pricingConfig.display_messages.recommendations) {
        const recommendation = document.getElementById('recommendation');
        if (recommendation) recommendation.style.display = 'none';
        return;
      }

      const recommendation = document.getElementById('recommendation');
      const recommendationText = document.getElementById('recommendationText');
      const rows = document.querySelectorAll("#bookTable tbody tr");
      const recs = pricingConfig.display_messages.recommendations;

      let hasRecommendation = false;

      rows.forEach((row, index) => {
        const pages = +row.querySelector(".pageCount").value;
        const hasOCR = row.querySelector(".ocr").checked;
        const hasHighRes = row.querySelector(".highRes").checked;
        const tocCount = parseInt(row.querySelector(".tocCount").value) || 0;

        // OCR 추천
        if (pages >= recs.ocr_threshold && !hasOCR && !hasRecommendation) {
          recommendationText.innerHTML = `📖 ${pages}쪽 두꺼운 책이라면 <strong>OCR 옵션</strong>을 추천해요! 나중에 검색이 가능합니다.`;
          hasRecommendation = true;
        }
        // 고해상도 추천
        else if (pages >= recs.high_res_threshold && !hasHighRes && !hasRecommendation) {
          recommendationText.innerHTML = `📊 ${pages}쪽 전문서라면 <strong>고해상도 옵션</strong>으로 더 선명하게! 이미지와 도표가 선명해집니다.`;
          hasRecommendation = true;
        }
        // 목차 추천
        else if (pages >= recs.toc_threshold && tocCount === 0 && !hasRecommendation) {
          recommendationText.innerHTML = `📚 ${pages}쪽 대용량 도서라면 <strong>목차 생성</strong>을 추천! 클릭 한 번으로 원하는 페이지 이동이 가능해요. (책과 함께 주문시 ${pricingConfig.toc_pricing.bundle_discount * 100}% 할인!)`;
          hasRecommendation = true;
        }
        // 올인원 패키지 추천
        else if (pages >= recs.bundle_threshold && (!hasOCR || !hasHighRes) && !hasRecommendation) {
          recommendationText.innerHTML = `⭐ <strong>올인원 패키지</strong>는 어떠세요? OCR + 고해상도로 완벽한 디지털화!`;
          hasRecommendation = true;
        }
      });

      recommendation.style.display = hasRecommendation ? 'block' : 'none';
    }

    // 긴급성 메시지
    function updateUrgencyMessage(bookSum) {
      if (!pricingConfig || !pricingConfig.promotion || !pricingConfig.display_messages || !pricingConfig.display_messages.urgency_messages) {
        const urgencyMessage = document.getElementById('urgencyMessage');
        if (urgencyMessage) urgencyMessage.style.display = 'none';
        return;
      }

      const urgencyMessage = document.getElementById('urgencyMessage');
      const promotion = pricingConfig.promotion;

      if (!promotion.active) {
        urgencyMessage.style.display = 'none';
        return;
      }

      // 특가 종료일 설정
      const endDate = new Date(promotion.end_date);
      const now = new Date();
      const timeDiff = endDate - now;

      // 특가 기간이 지났으면 메시지 숨김
      if (timeDiff <= 0) {
        urgencyMessage.style.display = 'none';
        return;
      }

      // 총 시간과 분으로 계산
      const totalHours = Math.floor(timeDiff / (1000 * 60 * 60));
      const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
      const timeMessage = `${totalHours}시간 ${minutes}분`;

      // 책이 3권 이상일 때 긴급성 메시지 표시
      if (bookSum >= 3) {
        const messages = pricingConfig.display_messages.urgency_messages;
        const randomMessage = messages[Math.floor(Math.random() * messages.length)];
        const finalMessage = randomMessage.replace('{time}', timeMessage);
        urgencyMessage.innerHTML = `<strong>${finalMessage}</strong>`;
        urgencyMessage.style.display = 'block';
      } else {
        urgencyMessage.style.display = 'none';
      }
    }

    // 가격표 업데이트 함수
    function updatePricingTable() {
      if (!pricingConfig) return;

      // 기본 가격표 업데이트 (첫 번째 테이블만 선택)
      const mainPriceTable = document.querySelector('.card-body .table-responsive table:not(.table-sm)');
      if (mainPriceTable) {
        const basePriceRows = mainPriceTable.querySelectorAll('tbody tr');
        const basePrices = pricingConfig.scan_pricing.base_prices;

        basePriceRows.forEach((row, index) => {
          if (index < basePrices.length && basePrices[index]) {
            const cells = row.querySelectorAll('td');
            if (cells.length >= 4) {
              if (basePrices[index].max_pages === null) {
                // 마지막 구간 (601쪽 이상)
                cells[1].textContent = `기본 ${basePrices[index].base_price}원 + (페이지초과÷100)*${basePrices[index].extra_per_100}원`;
              } else {
                cells[1].textContent = `${basePrices[index].price}원`;
              }
              cells[2].textContent = `+${pricingConfig.scan_pricing.options.ocr}원`;
              cells[3].textContent = `+${pricingConfig.scan_pricing.options.high_resolution}원`;
            }
          }
        });
      }

      // 목차 가격표 업데이트
      const tocTable = document.querySelector('.table-sm');
      if (tocTable) {
        const tocRows = tocTable.querySelectorAll('tbody tr');
        const tocTiers = pricingConfig.toc_pricing.tiers;
        const bundleDiscount = pricingConfig.toc_pricing.bundle_discount;

        tocRows.forEach((row, index) => {
          if (index < tocTiers.length && tocTiers[index]) {
            const cells = row.querySelectorAll('td');
            const tier = tocTiers[index];

            let regularPrice, discountPrice;

            if (tier.max_count === null) {
              regularPrice = `${tier.base_price}원~`;
              discountPrice = `${Math.round(tier.base_price * (1 - bundleDiscount))}원~`;
            } else if (tier.per_item > 0) {
              const maxPrice = tier.base_price + (tier.max_count - tier.threshold) * tier.per_item;
              regularPrice = `${tier.base_price}원 ~ ${maxPrice}원`;
              discountPrice = `${Math.round(tier.base_price * (1 - bundleDiscount))}원 ~ ${Math.round(maxPrice * (1 - bundleDiscount))}원`;
            } else {
              regularPrice = `${tier.base_price}원`;
              discountPrice = `${Math.round(tier.base_price * (1 - bundleDiscount))}원`;
            }

            if (cells.length >= 3) {
              cells[1].textContent = regularPrice;
              cells[2].innerHTML = `<span class="text-success fw-bold">${discountPrice}</span>`;
            }
          }
        });
      }

      // 할인율 표시 업데이트
      const discountBadges = document.querySelectorAll('.discount-percentage');
      pricingConfig.bulk_discounts.forEach((discount, index) => {
        if (discountBadges[index]) {
          discountBadges[index].textContent = `${discount.discount_rate * 100}%`;
        }
      });
    }

    // 툴팁 업데이트 함수
    function updateTooltips() {
      if (!pricingConfig) return;

      const tooltips = pricingConfig.display_messages.tooltips;

      // OCR 툴팁 업데이트
      const ocrTooltip = document.querySelector('.custom-tooltip');
      if (ocrTooltip && tooltips.ocr) {
        ocrTooltip.innerHTML = tooltips.ocr;
      }

      // 다른 툴팁들도 업데이트
      const allTooltips = document.querySelectorAll('.custom-tooltip');
      allTooltips.forEach((tooltip, index) => {
        const parentText = tooltip.parentElement.textContent.trim();
        if (parentText.includes('OCR') && tooltips.ocr) {
          tooltip.innerHTML = tooltips.ocr;
        } else if (parentText.includes('고해상도') && tooltips.high_resolution) {
          tooltip.innerHTML = tooltips.high_resolution;
        } else if (parentText.includes('목차') && tooltips.toc) {
          tooltip.innerHTML = tooltips.toc;
        }
      });
    }

    function prepareEstimate() {
      calculatePrice();
      let text = "[북스캔 서비스 견적서]\n";
      let hasTocDiscount = false;

      document.querySelectorAll("#bookTable tbody tr").forEach((row, idx) => {
        const p = row.querySelector(".pageCount").value;
        const o = row.querySelector(".ocr").checked ? 'OCR ' : '';
        const h = row.querySelector(".highRes").checked ? '고해상도 ' : '';
        const tocCount = parseInt(row.querySelector(".tocCount").value) || 0;
        let t = '';
        if (tocCount > 0) {
          t = `목차${tocCount}개(30%할인) `;
          hasTocDiscount = true;
        }
        const price = row.querySelector(".individualPrice").innerText;
        text += `책 ${idx + 1}: ${p}쪽, 옵션: ${o}${h}${t}, 가격: ${price}\n`;
      });

      text += document.getElementById("result").innerText + '\n';
      if (document.getElementById("discountInfo").innerText) {
        text += `(${document.getElementById("discountInfo").innerText})\n`;
      }

      if (hasTocDiscount) {
        text += '\n🎉 목차 작성 30% 할인이 적용되었습니다!\n';
      }

      document.getElementById("estimateContent").innerText = text;
      lastEstimateText = text;
    } function copyEstimate() {
      navigator.clipboard.writeText(lastEstimateText).then(() => {
        alert('견적서가 클립보드에 복사되었습니다.');
      });
    }

    function scrollToCalculator() {
      calculatePrice(); // 가격 계산 실행
      document.getElementById('price-calculator').scrollIntoView({
        behavior: 'smooth',
        block: 'start'
      });
    }
  </script>

</body>

</html>